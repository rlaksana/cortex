# =============================================================================
# CORTEX MEMORY MCP SERVER - STAGING ENVIRONMENT CONFIGURATION
# =============================================================================
# This file contains staging-specific configuration for the Cortex Memory MCP server.
# Staging sits between development and production with near-production settings.
#
# Purpose: Production-like testing before deployment to production
# Security: Medium security with production-like settings
# Performance: Optimized for testing realistic workloads
# =============================================================================
# Environment: STAGING (Production-like testing environment)
# Version: 2.0.1
# Last Updated: 2025-11-14
# =============================================================================

# =============================================================================
# üöÄ CORE CONFIGURATION
# =============================================================================
NODE_ENV=staging

# =============================================================================
# üîê SECURITY CONFIGURATION (Production-like)
# =============================================================================
# OpenAI API key (MANDATORY - use staging-specific key if possible)
OPENAI_API_KEY=your-staging-openai-api-key-here

# JWT secret for authentication (minimum 32 characters)
JWT_SECRET=your_staging_jwt_secret_key_minimum_32_characters

# API key validation for MCP operations
MCP_API_KEY=your_staging_mcp_api_key_minimum_48_characters

# Encryption key for sensitive data (minimum 64 characters hex)
ENCRYPTION_KEY=your_64_character_hex_encryption_key_here_for_staging

# =============================================================================
# üèóÔ∏è DATABASE CONFIGURATION
# =============================================================================
# Qdrant staging configuration (use staging-specific instance)
QDRANT_URL=https://staging-qdrant.your-domain.com
QDRANT_API_KEY=your-staging-qdrant-api-key
QDRANT_TIMEOUT=45000
QDRANT_COLLECTION_PREFIX=cortex-staging
QDRANT_COLLECTION_NAME=cortex-memory-staging

# Qdrant connection pool settings (production-like)
QDRANT_MAX_CONNECTIONS=15
QDRANT_CONNECTION_TIMEOUT=25000
QDRANT_KEEP_ALIVE=true
QDRANT_KEEP_ALIVE_TIMEOUT=25000

# =============================================================================
# üß† VECTOR EMBEDDING CONFIGURATION
# =============================================================================
# Vector settings for staging (same as production)
VECTOR_SIZE=1536
VECTOR_DISTANCE=Cosine
EMBEDDING_MODEL=text-embedding-ada-002
EMBEDDING_BATCH_SIZE=20
EMBEDDING_TIMEOUT=25000
EMBEDDING_RETRY_ATTEMPTS=3

# =============================================================================
# üîç SEARCH CONFIGURATION
# =============================================================================
# Staging search optimization (production-like limits)
SEARCH_LIMIT=75
SEARCH_MODE=deep
SIMILARITY_THRESHOLD=0.75
SEARCH_TIMEOUT=25000
SEARCH_CACHE_SIZE=7500
SEARCH_CACHE_TTL=5400

# =============================================================================
# üöÄ PERFORMANCE CONFIGURATION
# =============================================================================
# Staging performance settings (between dev and prod)
API_TIMEOUT=25000
DB_CONNECTION_TIMEOUT=25000
DB_RETRY_ATTEMPTS=4
DB_RETRY_DELAY=1500
DB_POOL_SIZE=15

# Memory management (staging optimized)
NODE_OPTIONS=--max-old-space-size=6144 --max-heap-size=6144 --expose-gc
ENABLE_GC=true
GC_INTERVAL=240000

# =============================================================================
# üõ°Ô∏è SECURITY CONFIGURATION
# =============================================================================
# CORS configuration (staging domains only)
CORS_ORIGIN=https://staging.your-domain.com,https://api-staging.your-domain.com

# Rate limiting (staging limits)
RATE_LIMIT_ENABLED=true
RATE_LIMIT_WINDOW_MS=600000
RATE_LIMIT_MAX_REQUESTS=750
RATE_LIMIT_SKIP_SUCCESSFUL_REQUESTS=false

# Security headers
HELMET_ENABLED=true
HELMET_CONTENT_SECURITY_POLICY=true
HELMET_HSTS_MAX_AGE=86400
HELMET_HSTS_INCLUDE_SUBDOMAINS=false
HELMET_HSTS_PRELOAD=false

# Input validation
MAX_REQUEST_SIZE_MB=8
MAX_BATCH_SIZE=75
VALIDATE_INPUTS=true
SANITIZE_INPUTS=true

# =============================================================================
# üìä MONITORING & LOGGING CONFIGURATION
# =============================================================================
# Staging logging (verbose for testing)
LOG_LEVEL=debug
LOG_FORMAT=json
LOG_TIMESTAMP=true
LOG_REQUEST_ID=true
LOG_STRUCTURED=true

# Metrics collection
ENABLE_METRICS_COLLECTION=true
METRICS_INTERVAL=45000
METRICS_RETENTION_DAYS=7

# Health checks
ENABLE_HEALTH_CHECKS=true
HEALTH_CHECK_INTERVAL=20000
HEALTH_CHECK_TIMEOUT=8000

# =============================================================================
# üîß MCP SERVER CONFIGURATION
# =============================================================================
# MCP server identification
MCP_SERVER_NAME=cortex-memory-staging
MCP_SERVER_VERSION=2.0.1
MCP_TRANSPORT=stdio
MCP_MAX_BATCH_SIZE=75
MCP_TIMEOUT=25000

# =============================================================================
# üè¢ STAGING SCOPE CONFIGURATION
# =============================================================================
# Staging project scope
CORTEX_ORG=your-staging-organization
CORTEX_PROJECT=cortex-memory-staging
CORTEX_BRANCH=staging

# =============================================================================
# ‚ö° CACHING CONFIGURATION
# =============================================================================
# Staging caching (shorter TTL for testing)
ENABLE_CACHING=true
CACHE_TTL=1800
CACHE_MAX_SIZE=25000
CACHE_STRATEGY=lfu
CACHE_REFRESH_INTERVAL=900

# =============================================================================
# üîÑ WORKER CONFIGURATION
# =============================================================================
# Background workers for staging (faster intervals)
ENABLE_TTL_WORKER=true
TTL_WORKER_INTERVAL=45000
TTL_BATCH_SIZE=75

ENABLE_CLEANUP_WORKER=true
CLEANUP_WORKER_INTERVAL=180000
CLEANUP_BATCH_SIZE=150

ENABLE_EXPIRY_WORKER=true
EXPIRY_WORKER_INTERVAL=90000
EXPIRY_BATCH_SIZE=100

# =============================================================================
# üéØ FEATURE FLAGS (STAGING)
# =============================================================================
# Staging feature toggles (enable all features for testing)
ENABLE_DEBUG_MODE=true
ENABLE_PERFORMANCE_MONITORING=true
ENABLE_AUDIT_LOGGING=true
ENABLE_ENCRYPTION=true
ENABLE_COMPRESSION=true
ENABLE_CIRCUIT_BREAKER=true

# =============================================================================
# üìà DEDUPLICATION CONFIGURATION
# =============================================================================
# Staging deduplication settings
DEDUPLICATION_ENABLED=true
DEDUPLICATION_STRATEGY=intelligent
DEDUPLICATION_SIMILARITY_THRESHOLD=0.80
DEDUPLICATION_BATCH_SIZE=40
DEDUPLICATION_CACHE_SIZE=5000

# =============================================================================
# üõ†Ô∏è TRUNCATION CONFIGURATION
# =============================================================================
# Content truncation for staging
TRUNCATION_ENABLED=true
TRUNCATION_MAX_CHARS=8000
TRUNCATION_MAX_TOKENS=3200
TRUNCATION_MODE=intelligent
TRUNCATION_PRESERVE_STRUCTURE=true

# =============================================================================
# üîî ALERTING CONFIGURATION
# =============================================================================
# Staging alerting (development team)
ENABLE_ALERTS=true
ALERT_WEBHOOK_URL=https://staging-alerts.your-webhook.com
ALERT_EMAIL_SMTP_HOST=smtp.staging-provider.com
ALERT_EMAIL_FROM=cortex-staging@your-domain.com
ALERT_EMAIL_TO=dev-team@your-domain.com

# =============================================================================
# üìã BACKUP CONFIGURATION
# =============================================================================
# Staging backup settings (shorter retention)
ENABLE_AUTO_BACKUP=true
BACKUP_INTERVAL=43200000
BACKUP_RETENTION_DAYS=7
BACKUP_LOCATION=/app/backups
BACKUP_ENCRYPTION=true

# =============================================================================
# üåê NETWORK CONFIGURATION
# =============================================================================
# Staging network settings
PORT=3000
HOST=0.0.0.0
ENABLE_COMPRESSION=true
COMPRESSION_THRESHOLD=512

# =============================================================================
# ‚ö†Ô∏è STAGING VALIDATION REQUIREMENTS
# =============================================================================
#
# BEFORE DEPLOYING TO STAGING, ENSURE:
#
# 1. ALL SECRETS ARE SET:
#    - OPENAI_API_KEY (valid staging key)
#    - JWT_SECRET (32+ characters)
#    - ENCRYPTION_KEY (64+ hex characters)
#    - MCP_API_KEY (48+ characters)
#    - QDRANT_API_KEY (if using managed Qdrant)
#
# 2. SECURITY CONFIGURATION:
#    - CORS_ORIGIN set to staging domains
#    - RATE_LIMIT_ENABLED=true
#    - HELMET_ENABLED=true
#    - Input validation enabled
#
# 3. STAGING URLS:
#    - QDRANT_URL points to staging cluster
#    - CORS_ORIGIN includes staging domains
#    - Alert endpoints configured
#
# 4. MONITORING:
#    - LOG_LEVEL=debug or info
#    - ENABLE_METRICS_COLLECTION=true
#    - Health checks enabled
#
# 5. PERFORMANCE:
#    - Appropriate timeout values
#    - Connection pooling configured
#    - Caching enabled with reasonable TTL
#
# 6. TESTING FEATURES:
#    - Debug mode enabled
#    - All feature flags enabled
#    - Enhanced logging for troubleshooting
#
# =============================================================================
# ENVIRONMENT VALIDATION
# =============================================================================
# This configuration will be validated at startup.
# Missing or invalid values will prevent server startup.
# =============================================================================