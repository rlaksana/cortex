generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model Section {
  id           String   @id @default(cuid())
  title        String   @db.VarChar(500)
  content      String?
  createdAt    DateTime @default(now()) @map("created_at")
  updatedAt    DateTime @updatedAt @map("updated_at")
  tags         Json     @default("{}")
  metadata     Json     @default("{}")
  created_by   String?  @default("system") @db.VarChar(200)
  updated_by   String?  @default("system") @db.VarChar(200)
  request_id   String?  @db.VarChar(100)
  content_hash String?  @db.VarChar(128)

  @@map("section")
}

model AdrDecision {
  id                     String    @id @default(cuid())
  component              String    @db.VarChar(200)
  status                 String    @db.VarChar(50)
  title                  String    @db.VarChar(500)
  rationale              String
  alternativesConsidered String[]
  createdAt              DateTime  @default(now()) @map("created_at")
  updatedAt              DateTime  @updatedAt @map("updated_at")
  tags                   Json      @default("{}")
  metadata               Json      @default("{}")
  created_by             String?   @default("system") @db.VarChar(200)
  updated_by             String?   @default("system") @db.VarChar(200)
  request_id             String?   @db.VarChar(100)
  content_hash           String?   @db.VarChar(128)
  accepted_at            DateTime? @db.Timestamptz(6)
  accepted_by            String?   @db.VarChar(200)

  @@index([updatedAt(sort: Desc), createdAt], map: "idx_adr_decision_updated_at_desc")
  @@map("adr_decision")
}

model IssueLog {
  id           String   @id @default(cuid())
  title        String   @db.VarChar(500)
  description  String?
  status       String   @db.VarChar(50)
  createdAt    DateTime @default(now()) @map("created_at")
  updatedAt    DateTime @updatedAt @map("updated_at")
  tags         Json     @default("{}")
  metadata     Json     @default("{}")
  created_by   String?  @default("system") @db.VarChar(200)
  updated_by   String?  @default("system") @db.VarChar(200)
  request_id   String?  @db.VarChar(100)
  content_hash String?  @db.VarChar(128)

  @@index([updatedAt(sort: Desc), createdAt], map: "idx_issue_log_updated_at_desc")
  @@map("issue_log")
}

model TodoLog {
  id           String    @id @default(cuid())
  title        String    @db.VarChar(500)
  description  String?
  status       String    @db.VarChar(50)
  priority     String?   @db.VarChar(50)
  dueDate      DateTime? @map("due_date")
  createdAt    DateTime  @default(now()) @map("created_at")
  updatedAt    DateTime  @updatedAt @map("updated_at")
  tags         Json      @default("{}")
  metadata     Json      @default("{}")
  closedAt     DateTime? @map("closed_at")
  created_by   String?   @default("system") @db.VarChar(200)
  updated_by   String?   @default("system") @db.VarChar(200)
  request_id   String?   @db.VarChar(100)
  content_hash String?   @db.VarChar(128)
  completed_at DateTime? @db.Timestamptz(6)
  completed_by String?   @db.VarChar(200)

  @@index([updatedAt(sort: Desc), createdAt], map: "idx_todo_log_updated_at_desc")
  @@map("todo_log")
}

model Runbook {
  id          String   @id @default(cuid())
  title       String   @db.VarChar(500)
  description String?
  steps       Json     @default("[]")
  createdAt   DateTime @default(now()) @map("created_at")
  updatedAt   DateTime @updatedAt @map("updated_at")
  tags        Json     @default("{}")
  metadata    Json     @default("{}")

  @@map("runbook")
}

model ChangeLog {
  id         String   @id @default(cuid())
  changeType String   @map("change_type") @db.VarChar(100)
  subjectRef String   @map("subject_ref") @db.VarChar(200)
  summary    String
  author     String   @db.VarChar(200)
  commitSha  String?  @map("commit_sha") @db.VarChar(100)
  createdAt  DateTime @default(now()) @map("created_at")
  updatedAt  DateTime @updatedAt @map("updated_at")
  tags       Json     @default("{}")
  metadata   Json     @default("{}")

  @@map("change_log")
}

model ReleaseNote {
  id        String   @id @default(cuid())
  version   String   @db.VarChar(100)
  summary   String
  createdAt DateTime @default(now()) @map("created_at")
  updatedAt DateTime @updatedAt @map("updated_at")
  tags      Json     @default("{}")
  metadata  Json     @default("{}")

  @@map("release_note")
}

model DdlHistory {
  id          String   @id @default(cuid())
  migrationId String   @map("migration_id") @db.VarChar(200)
  ddlText     String
  checksum    String   @db.VarChar(64)
  appliedAt   DateTime @default(now()) @map("applied_at")
  description String?
  status      String   @default("applied") @db.VarChar(20)
  tags        Json     @default("{}")
  metadata    Json     @default("{}")

  @@map("ddl_history")
}

model PrContext {
  id          String    @id @default(cuid())
  prNumber    Int       @map("pr_number")
  title       String    @db.VarChar(500)
  description String?
  author      String    @db.VarChar(200)
  status      String    @default("open") @db.VarChar(50)
  createdAt   DateTime  @default(now()) @map("created_at")
  updatedAt   DateTime  @updatedAt @map("updated_at")
  tags        Json      @default("{}")
  metadata    Json      @default("{}")
  mergedAt    DateTime? @map("merged_at")

  @@map("pr_context")
}

model KnowledgeEntity {
  id         String    @id @default(cuid())
  entityType String    @map("entity_type") @db.VarChar(100)
  name       String    @db.VarChar(500)
  data       Json      @default("{}")
  createdAt  DateTime  @default(now()) @map("created_at")
  updatedAt  DateTime  @updatedAt @map("updated_at")
  tags       Json      @default("{}")
  metadata   Json      @default("{}")
  deletedAt  DateTime? @map("deleted_at")

  @@map("knowledge_entity")
}

model KnowledgeRelation {
  id             String    @id @default(cuid())
  fromEntityType String    @map("from_entity_type") @db.VarChar(100)
  fromEntityId   String    @map("from_entity_id")
  toEntityType   String    @map("to_entity_type") @db.VarChar(100)
  toEntityId     String    @map("to_entity_id")
  relationType   String    @map("relation_type") @db.VarChar(100)
  createdAt      DateTime  @default(now()) @map("created_at")
  updatedAt      DateTime  @updatedAt @map("updated_at")
  tags           Json      @default("{}")
  metadata       Json      @default("{}")
  deletedAt      DateTime? @map("deleted_at")

  @@map("knowledge_relation")
}

model KnowledgeObservation {
  id          String    @id @default(cuid())
  entityType  String    @map("entity_type") @db.VarChar(100)
  entityId    String    @map("entity_id")
  observation String
  createdAt   DateTime  @default(now()) @map("created_at")
  updatedAt   DateTime  @updatedAt @map("updated_at")
  tags        Json      @default("{}")
  metadata    Json      @default("{}")
  deletedAt   DateTime? @map("deleted_at")

  @@map("knowledge_observation")
}

model IncidentLog {
  id               String   @id @default(cuid())
  title            String   @db.VarChar(500)
  severity         String   @db.VarChar(20)
  impact           String
  resolutionStatus String   @default("open") @map("resolution_status") @db.VarChar(50)
  createdAt        DateTime @default(now()) @map("created_at")
  updatedAt        DateTime @updatedAt @map("updated_at")
  tags             Json     @default("{}")
  metadata         Json     @default("{}")

  @@map("incident_log")
}

model ReleaseLog {
  id          String   @id @default(cuid())
  version     String   @db.VarChar(100)
  releaseType String   @map("release_type") @db.VarChar(50)
  scope       String
  status      String   @default("planned") @db.VarChar(50)
  createdAt   DateTime @default(now()) @map("created_at")
  updatedAt   DateTime @updatedAt @map("updated_at")
  tags        Json     @default("{}")
  metadata    Json     @default("{}")

  @@map("release_log")
}

model RiskLog {
  id                String   @id @default(cuid())
  title             String   @db.VarChar(500)
  category          String   @db.VarChar(50)
  riskLevel         String   @map("risk_level") @db.VarChar(20)
  impactDescription String   @map("impact_description")
  createdAt         DateTime @default(now()) @map("created_at")
  updatedAt         DateTime @updatedAt @map("updated_at")
  tags              Json     @default("{}")
  metadata          Json     @default("{}")
  status            String   @default("open") @db.VarChar(50)

  @@map("risk_log")
}

model AssumptionLog {
  id               String   @id @default(cuid())
  title            String   @db.VarChar(500)
  description      String
  category         String   @db.VarChar(50)
  validationStatus String   @default("assumed") @map("validation_status") @db.VarChar(50)
  impactIfInvalid  String   @map("impact_if_invalid")
  createdAt        DateTime @default(now()) @map("created_at")
  updatedAt        DateTime @updatedAt @map("updated_at")
  tags             Json     @default("{}")
  metadata         Json     @default("{}")

  @@map("assumption_log")
}

model PurgeMetadata {
  id                   Int      @id @unique @default(1)
  lastPurgeAt          DateTime @default(now()) @map("last_purge_at")
  operationsSincePurge Int      @default(0) @map("operations_since_purge")
  timeThresholdHours   Int      @default(24) @map("time_threshold_hours")
  operationThreshold   Int      @default(1000) @map("operation_threshold")
  deletedCounts        Json     @default("{}")
  lastDurationMs       Int?     @map("last_duration_ms")
  enabled              Boolean  @default(true)
  createdAt            DateTime @default(now()) @map("created_at")
  updatedAt            DateTime @updatedAt @map("updated_at")

  @@map("purge_metadata")
}

model EventAudit {
  id        String   @id @default(cuid())
  eventType String   @map("event_type") @db.VarChar(100)
  tableName String   @map("table_name") @db.VarChar(100)
  recordId  String   @map("record_id") @db.VarChar(500)
  operation String   @db.VarChar(10)
  oldData   Json?    @map("old_data")
  newData   Json?    @map("new_data")
  changedBy String?  @map("changed_by") @db.VarChar(200)
  tags      Json     @default("{}")
  metadata  Json     @default("{}")
  createdAt DateTime @default(now()) @map("created_at")

  @@map("event_audit")
}

model assumption {
  id                  String    @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  title               String    @db.VarChar(500)
  description         String
  validation_status   String?   @default("unvalidated") @db.VarChar(50)
  dependencies        Json?     @default("[]")
  impact_if_invalid   String?
  validation_metadata Json?     @default("{\"last_validated\": null, \"confidence_level\": \"low\", \"validation_method\": \"none\"}")
  created_by          String?   @default("system") @db.VarChar(200)
  updated_by          String?   @default("system") @db.VarChar(200)
  request_id          String?   @db.VarChar(100)
  content_hash        String?   @db.VarChar(128)
  project             String?   @db.VarChar(100)
  branch              String?   @db.VarChar(100)
  org                 String?   @db.VarChar(100)
  created_at          DateTime? @default(now()) @db.Timestamptz(6)
  updated_at          DateTime? @default(now()) @db.Timestamptz(6)
  tags                Json?     @default("{}")
  metadata            Json?     @default("{}")
  deleted_at          DateTime? @db.Timestamptz(6)
}

model ddl_log {
  id             String    @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  migration_name String    @db.VarChar(200)
  description    String
  sql_content    String
  rollback_sql   String?
  migration_type String?   @default("other") @db.VarChar(50)
  status         String?   @default("pending") @db.VarChar(50)
  created_by     String?   @default("system") @db.VarChar(200)
  updated_by     String?   @default("system") @db.VarChar(200)
  request_id     String?   @db.VarChar(100)
  content_hash   String?   @db.VarChar(128)
  project        String?   @db.VarChar(100)
  branch         String?   @db.VarChar(100)
  org            String?   @db.VarChar(100)
  created_at     DateTime? @default(now()) @db.Timestamptz(6)
  updated_at     DateTime? @default(now()) @db.Timestamptz(6)
  tags           Json?     @default("{}")
  metadata       Json?     @default("{}")
  deleted_at     DateTime? @db.Timestamptz(6)
}

model entity {
  id           String    @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  name         String    @db.VarChar(200)
  type         String    @db.VarChar(100)
  description  String?
  created_by   String?   @default("system") @db.VarChar(200)
  updated_by   String?   @default("system") @db.VarChar(200)
  request_id   String?   @db.VarChar(100)
  content_hash String?   @db.VarChar(128)
  project      String?   @db.VarChar(100)
  branch       String?   @db.VarChar(100)
  org          String?   @db.VarChar(100)
  created_at   DateTime? @default(now()) @db.Timestamptz(6)
  updated_at   DateTime? @default(now()) @db.Timestamptz(6)
  tags         Json?     @default("{}")
  metadata     Json?     @default("{}")
  deleted_at   DateTime? @db.Timestamptz(6)
}

model incident {
  id                  String    @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  title               String    @db.VarChar(500)
  severity            String    @db.VarChar(50)
  impact              String
  impact_score        Int?      @default(1)
  detected_at         DateTime? @default(now()) @db.Timestamptz(6)
  timeline            Json?     @default("[]")
  root_cause_analysis String?
  resolution          String?
  created_by          String?   @default("system") @db.VarChar(200)
  updated_by          String?   @default("system") @db.VarChar(200)
  request_id          String?   @db.VarChar(100)
  content_hash        String?   @db.VarChar(128)
  project             String?   @db.VarChar(100)
  branch              String?   @db.VarChar(100)
  org                 String?   @db.VarChar(100)
  created_at          DateTime? @default(now()) @db.Timestamptz(6)
  updated_at          DateTime? @default(now()) @db.Timestamptz(6)
  tags                Json?     @default("{}")
  metadata            Json?     @default("{}")
  deleted_at          DateTime? @db.Timestamptz(6)
}

model observation {
  id           String    @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  entity_id    String    @db.Uuid
  fact         String    @db.VarChar(1000)
  value        Json?
  confidence   Decimal?  @default(1.0) @db.Decimal(3, 2)
  observed_at  DateTime? @default(now()) @db.Timestamptz(6)
  created_by   String?   @default("system") @db.VarChar(200)
  updated_by   String?   @default("system") @db.VarChar(200)
  request_id   String?   @db.VarChar(100)
  content_hash String?   @db.VarChar(128)
  project      String?   @db.VarChar(100)
  branch       String?   @db.VarChar(100)
  org          String?   @db.VarChar(100)
  created_at   DateTime? @default(now()) @db.Timestamptz(6)
  updated_at   DateTime? @default(now()) @db.Timestamptz(6)
  tags         Json?     @default("{}")
  metadata     Json?     @default("{}")
  deleted_at   DateTime? @db.Timestamptz(6)
}

model relation {
  id               String    @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  source_entity_id String    @db.Uuid
  target_entity_id String    @db.Uuid
  relation_type    String    @db.VarChar(100)
  description      String?
  bidirectional    Boolean?  @default(false)
  strength         String?   @default("normal") @db.VarChar(50)
  created_by       String?   @default("system") @db.VarChar(200)
  updated_by       String?   @default("system") @db.VarChar(200)
  request_id       String?   @db.VarChar(100)
  content_hash     String?   @db.VarChar(128)
  project          String?   @db.VarChar(100)
  branch           String?   @db.VarChar(100)
  org              String?   @db.VarChar(100)
  created_at       DateTime? @default(now()) @db.Timestamptz(6)
  updated_at       DateTime? @default(now()) @db.Timestamptz(6)
  tags             Json?     @default("{}")
  metadata         Json?     @default("{}")
  deleted_at       DateTime? @db.Timestamptz(6)
}

model release {
  id               String    @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  version          String    @db.VarChar(50)
  scope            String    @db.VarChar(1000)
  status           String?   @default("planned") @db.VarChar(50)
  semantic_version String?   @db.VarChar(50)
  deployment_date  DateTime? @db.Timestamptz(6)
  rollback_plan    String?
  created_by       String?   @default("system") @db.VarChar(200)
  updated_by       String?   @default("system") @db.VarChar(200)
  request_id       String?   @db.VarChar(100)
  content_hash     String?   @db.VarChar(128)
  project          String?   @db.VarChar(100)
  branch           String?   @db.VarChar(100)
  org              String?   @db.VarChar(100)
  created_at       DateTime? @default(now()) @db.Timestamptz(6)
  updated_at       DateTime? @default(now()) @db.Timestamptz(6)
  tags             Json?     @default("{}")
  metadata         Json?     @default("{}")
  deleted_at       DateTime? @db.Timestamptz(6)
}

model risk {
  id                    String    @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  title                 String    @db.VarChar(500)
  description           String
  impact_probability    Decimal   @db.Decimal(3, 2)
  impact_severity       String    @db.VarChar(50)
  risk_score            Decimal?  @db.Decimal(5, 2)
  mitigation_strategies Json?     @default("[]")
  status                String?   @default("identified") @db.VarChar(50)
  created_by            String?   @default("system") @db.VarChar(200)
  updated_by            String?   @default("system") @db.VarChar(200)
  request_id            String?   @db.VarChar(100)
  content_hash          String?   @db.VarChar(128)
  project               String?   @db.VarChar(100)
  branch                String?   @db.VarChar(100)
  org                   String?   @db.VarChar(100)
  created_at            DateTime? @default(now()) @db.Timestamptz(6)
  updated_at            DateTime? @default(now()) @db.Timestamptz(6)
  tags                  Json?     @default("{}")
  metadata              Json?     @default("{}")
  deleted_at            DateTime? @db.Timestamptz(6)
}
