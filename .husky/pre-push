#!/usr/bin/env sh
. "$(dirname -- "$0")/_/husky.sh"

echo "ğŸš€ Running pre-push validation checks..."

# Run full test suite
echo "ğŸ§ª Running full test suite..."
npm run test:ci || {
  echo "âŒ Full test suite failed"
  exit 1
}

# Run integration tests
echo "ğŸ”— Running integration tests..."
npm run test:integration || {
  echo "âŒ Integration tests failed"
  exit 1
}

# Run security audit
echo "ğŸ”’ Running security audit..."
npm run security:check || {
  echo "âŒ Security audit failed"
  exit 1
}

# Validate MCP tools
echo "ğŸ› ï¸ Validating MCP tools..."
npm run mcp:validate-tools || {
  echo "âŒ MCP tool validation failed"
  exit 1
}

# Build project to ensure it compiles
echo "ğŸ—ï¸ Building project..."
npm run build || {
  echo "âŒ Build failed"
  exit 1
}

# Run quality gate
echo "ğŸ¯ Running quality gate..."
npm run quality-gate:ci || {
  echo "âŒ Quality gate failed"
  exit 1
}

# Generate documentation
echo "ğŸ“š Generating documentation..."
npm run docs:generate || {
  echo "âŒ Documentation generation failed"
  exit 1
}

# Validate documentation
echo "ğŸ“– Validating documentation..."
npm run docs:validate || {
  echo "âŒ Documentation validation failed"
  exit 1
}

echo "âœ… All pre-push checks passed!"
echo "ğŸ‰ Ready to push changes!"