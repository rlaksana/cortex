# AI Assistant Guidelines - Cortex Memory MCP

## üö® IMPORTANT: Single Index Policy

### **BEFORE CREATING ANY INDEX FILE:**
1. **CHECK** if `src/index.ts` already exists
2. **IF EXISTS**: Modify existing file
3. **IF NOT EXISTS**: Create ONLY `src/index.ts`
4. **NEVER**: Create `index-[suffix].ts` for any reason

## üìã Mandatory Pre-Flight Checklist

### **For Index File Creation:**
```
‚ñ° Does src/index.ts already exist?
  ‚Üí YES: Modify existing file
  ‚Üí NO: Create ONLY src/index.ts
‚ñ° Am I about to create index-[suffix].ts?
  ‚Üí YES: üö´ STOP! Use src/index.ts instead
  ‚Üí NO: ‚úÖ Proceed
```

### **For MCP Configuration:**
```
‚ñ° Is config pointing to dist/index.js? (REQUIRED)
‚ñ° Keep it simple with hardcoded paths (RECOMMENDED)
‚ñ° Only API key needs environment variable (REQUIRED)
```

## üéØ Current Project State

### **‚úÖ ESTABLISHED:**
- **Single Index**: `src/index.ts` (full features)
- **Build Output**: `dist/index.js` (unified)
- **Features**: 4 tools (memory_store, memory_find, database_health, database_stats)
- **Compatibility**: Claude Code, OpenAI CLI, Gemini CLI

### **üö´ FORBIDDEN PATTERNS:**
- Multiple index files for different CLI tools
- Separate minimal/full versions
- Build outputs for different variants

## üîß Correct Implementation Patterns

### **If you need different behavior:**
```typescript
// Use environment variables and feature flags
const isDevelopment = process.env.NODE_ENV === 'development';
const enableAdvancedFeatures = process.env.CORTEX_ADVANCED_FEATURES === 'true';

if (enableAdvancedFeatures) {
  // Load all features
} else {
  // Load minimal features
}
```

### **If you need CLI-specific features:**
```typescript
// Detect CLI type from environment or process
const cliType = process.env.CLI_TYPE || 'default';

switch (cliType) {
  case 'claude-code':
    // Claude Code specific optimizations
    break;
  case 'openai-cli':
    // OpenAI CLI specific optimizations
    break;
  default:
    // Universal configuration
}
```

## ‚ö†Ô∏è Common Mistakes to Avoid

### **‚ùå FORBIDDEN:**
```bash
# Don't create multiple index files
touch src/index-claude.ts    # ‚ùå FORBIDDEN
touch src/index-minimal.ts   # ‚ùå FORBIDDEN
touch src/index-full.ts      # ‚ùå FORBIDDEN
```

```json
// Don't configure multiple entry points
{
  "mcpServers": {
    "cortex-minimal": {"args": ["dist/index-minimal.js"]},     // ‚ùå FORBIDDEN
    "cortex-full": {"args": ["dist/index-full.js"]}           // ‚ùå FORBIDDEN
  }
}
```

### **‚úÖ CORRECT:**
```bash
# Only use the single index file
edit src/index.ts           # ‚úÖ CORRECT
build src/index.ts          # ‚úÖ CORRECT
```

```json
// Use single entry point with feature flags
{
  "mcpServers": {
    "cortex": {
      "args": ["dist/index.js"],
      "env": {
        "CORTEX_ADVANCED_FEATURES": "true"    // ‚úÖ CORRECT
      }
    }
  }
}
```

## üöÄ Quick Start Commands

### **Development:**
```bash
# Check current index
ls -la src/index.ts

# Build unified version
npm run build

# Test single entry point
node dist/index.js
```

### **Configuration:**
```json
{
  "mcpServers": {
    "cortex": {
      "command": "node",
      "args": ["D:\\WORKSPACE\\tools-node\\mcp-cortex\\dist\\index.js"]
    }
  }
}
```

## üîç Detection Helpers

### **Bash Commands to Check Policy Compliance:**
```bash
# Check for multiple index files
find src/ -name "index-*.ts" -type f  # Should return empty

# Verify single entry point
ls dist/index.js                      # Should exist
ls dist/index-*.js                    # Should return empty

# Check package.json compliance
grep -E "index-.*\.js" package.json  # Should return empty
```

### **PowerShell Commands:**
```powershell
# Check for forbidden index files
Get-ChildItem -Path "src\index-*.ts"  # Should return empty

# Verify correct output
Test-Path "dist\index.js"             # Should be True
Get-ChildItem -Path "dist\index-*.js" # Should return empty
```

## üìû When in Doubt

1. **Read** `DEVELOPMENT-POLICY.md` thoroughly
2. **Use** environment variables for different behavior
3. **Modify** existing `src/index.ts` instead of creating new files
4. **Keep** MCP configuration pointing to single `dist/index.js`

## üéñÔ∏è AI Assistant Best Practices

### **‚úÖ DO:**
- Always check for existing `src/index.ts`
- Use feature flags for conditional behavior
- Keep single entry point in all configurations
- Read `DEVELOPMENT-POLICY.md` before making changes

### **‚ùå DON'T:**
- Create multiple index files for any reason
- Configure different entry points for different CLI tools
- Build multiple variants from different sources
- Assume you need separate files for different use cases

---

**üéØ REMEMBER: One Index to Rule Them All**

*This file must be read by any AI assistant before modifying index files in this project.*