/**
 * Security Runtime Types
 *
 * Type definitions for the comprehensive security runtime checks system
 */

export enum SecurityLevel {
  LOW = 1,
  MEDIUM = 2,
  HIGH = 3,
  CRITICAL = 4,
}

/**
 * Convert string severity to SecurityLevel enum
 */
export function severityToSecurityLevel(
  severity: 'low' | 'medium' | 'high' | 'critical'
): SecurityLevel {
  switch (_severity) {
    case 'low':
      return SecurityLevel.LOW;
    case 'medium':
      return SecurityLevel.MEDIUM;
    case 'high':
      return SecurityLevel.HIGH;
    case 'critical':
      return SecurityLevel.CRITICAL;
    default:
      return SecurityLevel.LOW;
  }
}

export enum ThreatLevel {
  UNKNOWN = 'unknown',
  LOW = 'low',
  MEDIUM = 'medium',
  HIGH = 'high',
  CRITICAL = 'critical',
}

export interface SecurityContext {
  id: string;
  userId?: string;
  sessionId?: string;
  ipAddress?: string;
  userAgent?: string;
  operation?: string;
  resource?: string;
  timestamp: Date;
  requestId?: string;
  tenantId?: string;
  roles?: string[];
  permissions?: string[];
  metadata?: Record<string, unknown>;
}

export interface SecurityViolation {
  type: string;
  severity: 'low' | 'medium' | 'high' | 'critical';
  description: string;
  recommendation?: string;
  evidence?: unknown;
  timestamp?: Date;
}

export interface ValidationResult {
  valid: boolean;
  level: SecurityLevel;
  violations: SecurityViolation[];
  metadata?: Record<string, unknown>;
}

export interface AccessControlDecision {
  allowed: boolean;
  reason?: string;
  conditions?: string[];
  expiresAt?: Date;
}

export interface SecurityEvent {
  type: string;
  result: ValidationResult;
  request: unknown;
  context: SecurityContext;
  timestamp: Date;
  metadata?: Record<string, unknown>;
}

export interface SecurityMetrics {
  totalRequests: number;
  blockedRequests: number;
  threatsDetected: number;
  anomaliesDetected: number;
  piiIncidents: number;
  secretIncidents: number;
  averageResponseTime: number;
  topViolationTypes: Array<{
    type: string;
    count: number;
  }>;
}

export interface ThreatPattern {
  id: string;
  name: string;
  category: string;
  pattern: RegExp;
  severity: string;
  description: string;
  recommendation: string;
  enabled: boolean;
}

export interface SecurityRule {
  id: string;
  name: string;
  type: 'input' | 'access' | 'data' | 'behavior';
  enabled: boolean;
  conditions: Record<string, unknown>;
  actions: string[];
  priority: number;
}

export interface SecurityAlert {
  id: string;
  type: string;
  severity: string;
  title: string;
  description: string;
  context: SecurityContext;
  violations: SecurityViolation[];
  actions: string[];
  status: 'open' | 'investigating' | 'resolved' | 'closed';
  createdAt: Date;
  updatedAt: Date;
  assignedTo?: string;
  resolution?: string;
}

export interface UserBehaviorProfile {
  userId: string;
  baselineMetrics: {
    averageRequestsPerHour: number;
    averageDataSize: number;
    commonOperations: string[];
    typicalTimeRanges: string[];
    commonIPAddresses: string[];
  };
  riskScore: number;
  lastUpdated: Date;
  anomalies: Array<{
    timestamp: Date;
    type: string;
    score: number;
    description: string;
  }>;
}

export interface SecurityIncident {
  id: string;
  type: string;
  severity: string;
  title: string;
  description: string;
  context: SecurityContext;
  timeline: Array<{
    timestamp: Date;
    event: string;
    details: unknown;
  }>;
  impact: {
    usersAffected: number;
    dataExposed: boolean;
    systemsAffected: string[];
    estimatedDamage: string;
  };
  status: 'open' | 'investigating' | 'contained' | 'resolved';
  assignedTo?: string;
  createdAt: Date;
  updatedAt: Date;
  resolution?: string;
  lessonsLearned?: string;
}

export interface DataClassification {
  level: 'public' | 'internal' | 'confidential' | 'restricted';
  categories: string[];
  handlingRequirements: string[];
  retentionPeriod?: number;
  encryptionRequired: boolean;
  auditRequired: boolean;
}

export interface PIIDetection {
  type: string;
  pattern: RegExp;
  confidence: number;
  location: string;
  value?: string;
  masked?: boolean;
  category?: 'personal' | 'financial' | 'health' | 'contact' | 'government';
  gdpr_relevant?: boolean;
}

export interface SecretDetection {
  type: string;
  pattern: RegExp;
  confidence: number;
  location: string;
  severity: string;
  revoked?: boolean;
  category?: 'api_key' | 'password' | 'certificate' | 'token' | 'private_key';
}

export interface AnomalyDetection {
  type: string;
  score: number;
  threshold: number;
  baseline: unknown;
  current: unknown;
  description: string;
  confidence: number;
  recommendations: string[];
}

export interface SecurityConfiguration {
  global: {
    enabled: boolean;
    strictMode: boolean;
    failClosed: boolean;
    logLevel: string;
  };
  inputValidation: {
    maxInputSize: number;
    timeout: number;
    deepValidation: boolean;
    sanitization: boolean;
  };
  accessControl: {
    rbac: boolean;
    abac: boolean;
    sessionValidation: boolean;
    multiFactorAuth: boolean;
  };
  dataProtection: {
    piiDetection: boolean;
    dataMasking: boolean;
    secretDetection: boolean;
    encryptionAtRest: boolean;
    encryptionInTransit: boolean;
  };
  monitoring: {
    anomalyDetection: boolean;
    behaviorAnalysis: boolean;
    threatIntelligence: boolean;
    realTimeAlerts: boolean;
  };
  rateLimiting: {
    enabled: boolean;
    adaptive: boolean;
    perUser: boolean;
    perIP: boolean;
    global: boolean;
  };
  response: {
    autoBlock: boolean;
    quarantine: boolean;
    alertThreshold: number;
    quarantineDuration: number;
    notificationChannels: string[];
  };
}

export interface SecurityPolicy {
  id: string;
  name: string;
  description: string;
  category: string;
  rules: SecurityRule[];
  enabled: boolean;
  priority: number;
  conditions: Record<string, unknown>;
  actions: string[];
  exceptions: string[];
  lastReviewed: Date;
  nextReview: Date;
  owner: string;
  approvers: string[];
}

export interface ComplianceRequirement {
  id: string;
  name: string;
  framework: string;
  category: string;
  description: string;
  controls: Array<{
    id: string;
    name: string;
    description: string;
    implementation: string;
    testing: string;
    evidence: string[];
  }>;
  status: 'compliant' | 'non_compliant' | 'partial' | 'not_assessed';
  lastAssessed: Date;
  nextAssessment: Date;
  owner: string;
}

export interface SecurityAuditLog {
  id: string;
  timestamp: Date;
  event: string;
  category: string;
  severity: string;
  userId?: string;
  sessionId?: string;
  ipAddress?: string;
  userAgent?: string;
  resource?: string;
  action?: string;
  result: 'success' | 'failure' | 'blocked';
  details: Record<string, unknown>;
  metadata?: Record<string, unknown>;
}

export interface SecurityDashboard {
  overview: {
    totalRequests: number;
    blockedRequests: number;
    threatScore: number;
    riskLevel: string;
    activeIncidents: number;
    openAlerts: number;
  };
  _metrics: SecurityMetrics;
  topThreats: Array<{
    type: string;
    count: number;
    trend: 'increasing' | 'decreasing' | 'stable';
  }>;
  recentIncidents: SecurityIncident[];
  systemHealth: {
    status: 'healthy' | 'degraded' | 'critical';
    services: Array<{
      name: string;
      status: string;
      lastCheck: Date;
    }>;
  };
}

export interface SecurityReport {
  id: string;
  type: 'daily' | 'weekly' | 'monthly' | 'incident' | 'compliance';
  generatedAt: Date;
  period: {
    start: Date;
    end: Date;
  };
  summary: {
    totalRequests: number;
    securityEvents: number;
    incidentsResolved: number;
    riskScore: number;
    complianceStatus: string;
  };
  details: {
    topViolations: Array<{
      type: string;
      count: number;
      severity: string;
    }>;
    userActivity: Array<{
      userId: string;
      requests: number;
      violations: number;
      riskScore: number;
    }>;
    systemPerformance: {
      averageResponseTime: number;
      availability: number;
      errorRate: number;
    };
  };
  recommendations: string[];
  actionItems: Array<{
    description: string;
    priority: string;
    assignee?: string;
    dueDate?: Date;
  }>;
}
