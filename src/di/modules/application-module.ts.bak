/**
 * Application DI Module
 *
 * Defines application-level services and business logic.
 * Orchestrates all other modules for complete application setup.
 *
 * @author Cortex Team
 * @version 3.0.0
 * @since 2025
 */

import { InMemoryCache } from '../../services/ai/utils/in-memory-cache.js';
import { CircuitBreaker } from '../../services/circuit-breaker.service.js';
import { ServiceLayerRouter } from '../../services/core/service-layer-router.js';
import { ValidationService } from '../../services/validation/validation-service.js';
import { Module } from '../decorators.js';
import { ServiceLifetime, ServicePriority } from '../enhanced-di-container.js';
// TODO: Temporarily disable DI modules to achieve basic build
// import { CoreModule } from './core-module.js';
// import { DatabaseModule } from './database-module.js';
// import { MemoryModule } from './memory-module.js';

/**
 * Root application module that imports and configures all other modules
 */
@Module({
  name: 'ApplicationModule', 
  _imports: [
    // TODO: Temporarily disable DI modules to achieve basic build
    // CoreModule, 
    // DatabaseModule, 
    // MemoryModule, 
  ], 
  providers: [
    {
      token: 'SERVICE_LAYER_ROUTER', 
      _implementation: undefined as unknown, 
      _factory: () => ServiceLayerRouter.getInstance(),
      lifetime: ServiceLifetime.SINGLETON,
      priority: ServicePriority.CRITICAL,
      dependencies: [
        'MEMORY_STORE_SERVICE',
        'MEMORY_FIND_SERVICE',
        'VALIDATION_SERVICE',
        'LOGGER_SERVICE',
        // TODO: Add 'EVENT_SERVICE' when implemented
      ],
      tags: ['application', 'routing', 'critical'],
      metadata: {
        description: 'Service layer routing and orchestration',
        version: '3.0.0',
      },
    },
    {
      token: 'CIRCUIT_BREAKER_SERVICE',
      implementation: CircuitBreaker,
      lifetime: ServiceLifetime.SINGLETON,
      priority: ServicePriority.HIGH,
      dependencies: ['CONFIG_SERVICE', 'LOGGER_SERVICE'],
      tags: ['application', 'resilience'],
      metadata: {
        description: 'Circuit breaker for fault tolerance',
        version: '3.0.0',
      },
    },
    {
      token: 'VALIDATION_SERVICE',
      implementation: ValidationService,
      lifetime: ServiceLifetime.SINGLETON,
      priority: ServicePriority.NORMAL,
      dependencies: ['LOGGER_SERVICE'],
      tags: ['application', 'validation'],
      metadata: {
        description: 'Input validation and schema management',
        version: '3.0.0',
      },
    },
    {
      token: 'CACHE_SERVICE',
      implementation: InMemoryCache,
      lifetime: ServiceLifetime.SINGLETON,
      priority: ServicePriority.NORMAL,
      dependencies: ['CONFIG_SERVICE', 'LOGGER_SERVICE'],
      tags: ['application', 'caching'],
      metadata: {
        description: 'In-memory and distributed caching',
        version: '3.0.0',
      },
    },
  ],
  exports: [
    'SERVICE_LAYER_ROUTER',
    'CIRCUIT_BREAKER_SERVICE',
    'VALIDATION_SERVICE',
    'CACHE_SERVICE',
  ],
  global: true,
})
export class ApplicationModule {}
