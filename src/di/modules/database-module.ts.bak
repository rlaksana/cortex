/**
 * Database DI Module
 *
 * Defines database-related services and repositories.
 * Handles data access layer dependencies.
 *
 * @author Cortex Team
 * @version 3.0.0
 * @since 2025
 */

import { getQdrantClient, getRepositoryFactory } from '../../db/qdrant-client.js';
import { DatabaseAccessInterceptor } from '../../services/core/database-access-interceptor.js';
import { Module } from '../decorators.js';
import { ServiceLifetime, ServicePriority } from '../enhanced-di-container.js';

/**
 * Database module providing data access services
 */
@Module({
  name: 'DatabaseModule', 
  _imports: [],  // Dependencies on CoreModule are implicit
  providers: [
    {
      token: 'DATABASE_SERVICE', 
      _implementation: undefined as unknown, 
      _factory: () => DatabaseAccessInterceptor.getInstance(),
      lifetime: ServiceLifetime.SINGLETON,
      priority: ServicePriority.HIGH,
      dependencies: ['CONFIG_SERVICE', 'LOGGER_SERVICE'],
      tags: ['database', 'infrastructure'],
      metadata: {
        description: 'Database connection and management',
        version: '3.0.0',
      },
    },
    {
      token: 'QDRANT_SERVICE',
      implementation: undefined as unknown,
      factory: () => getQdrantClient(),
      lifetime: ServiceLifetime.SINGLETON,
      priority: ServicePriority.HIGH,
      dependencies: ['DATABASE_SERVICE', 'CONFIG_SERVICE', 'LOGGER_SERVICE'],
      tags: ['database', 'vector', 'qdrant'],
      metadata: {
        description: 'Qdrant vector database service',
        version: '3.0.0',
      },
    },
    {
      token: 'REPOSITORY_FACTORY',
      implementation: undefined as unknown,
      factory: () => getRepositoryFactory(),
      lifetime: ServiceLifetime.SINGLETON,
      priority: ServicePriority.HIGH,
      dependencies: ['QDRANT_SERVICE', 'CONFIG_SERVICE', 'LOGGER_SERVICE'],
      tags: ['database', 'repository', 'factory'],
      metadata: {
        description: 'Repository factory for data access',
        version: '3.0.0',
      },
    },
  ],
  exports: ['DATABASE_SERVICE', 'QDRANT_SERVICE', 'REPOSITORY_FACTORY'],
})
export class DatabaseModule {}
