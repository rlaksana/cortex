/**
 * Audit Service Adapter
 *
 * Adapts the AuditService to implement the IAuditService interface.
 * Bridges interface gaps while maintaining backward compatibility.
 *
 * @author Cortex Team
 * @version 2.0.0
 * @since 2025
 */

import { auditService } from '../../services/audit/audit-service.js';
import type { IAuditService } from '../service-interfaces.js';

/**
 * Adapter for Audit service
 */
export class AuditServiceAdapter implements IAuditService {
  constructor(private service = auditService) {}

  /**
   * Log an audit event
   */
 log(action: string, data: unknown): Promise<void> {
    // Map to the audit service's logSearchOperation method
    this.service.logSearchOperation(
      data.userId || 'anonymous',
      data.query || '',
      data.resultsFound || 0
    );
  }

  /**
   * Query audit events with filters
   */
 query(filters: Record<string, unknown>): Promise<unknown[]> {
    const events = this.service.searchAuditEvents({
      userId: filters.userId,
      action: filters.eventType,
      resource: filters.operation,
      outcome: filters.success ? 'success' : 'failure',
      startDate: filters.startDate,
      endDate: filters.endDate,
    });

    return events;
  }

  /**
   * Archive audit events before a specified date
   */
 archive(before: Date): Promise<number> {
    const result = this.service.cleanupOldEvents(before);
    return result;
  }

  /**
   * Log security event
   */
  async logSecurityEvent(event: unknown): Promise<void> {
    // Use the log method with security-specific action
    await this.log('security_event', {
      eventType: 'SECURITY_VIOLATION',
      userId: event.userId,
      resource: event.resource,
      operation: event.operation,
      success: false,
      metadata: event.metadata || {},
      timestamp: new Date(),
    });
  }
}
