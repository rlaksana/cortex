# ============================================================================
# CORTEX MEMORY MCP - KUBERNETES SECRETS CONFIGURATION
# ============================================================================
#
# IMPORTANT: These secrets should be created using proper secret management tools
# like kubectl, sealed secrets, or external secret providers in production.
# This file is for reference only and contains placeholder values.

apiVersion: v1
kind: Secret
metadata:
  name: cortex-mcp-secrets
  namespace: cortex-mcp
  labels:
    app.kubernetes.io/name: cortex-mcp
    app.kubernetes.io/component: secrets
    app.kubernetes.io/part-of: cortex-memory
  annotations:
    description: 'Cortex MCP application secrets - replace with real values'
type: Opaque
data:
  # Base64 encoded secrets - replace with your actual encoded values
  # To encode: echo -n "your-secret" | base64
  JWT_SECRET: Y2hhbmdlLW1lLWluLXByb2R1Y3Rpb24= # change-me-in-production
  API_KEY: Y2hhbmdlLW1lLWluLXByb2R1Y3Rpb24= # change-me-in-production
  OPENAI_API_KEY: eW91ci1vcGVuYWktYXBpLWtleQ== # your-openai-api-key
  SESSION_SECRET: Y2hhbmdlLW1lLWluLXByb2R1Y3Rpb24= # change-me-in-production
  ENCRYPTION_KEY: eW91ci0zMi1ieXRlLWVuY3J5cHRpb24ta2V5 # your-32-byte-encryption-key
  DATABASE_PASSWORD: cWRyYW50LXBhc3N3b3Jk # qdrant-password
  REDIS_PASSWORD: cmVkaXMtcGFzc3dvcmQ= # redis-password

---
# Monitoring Secrets
apiVersion: v1
kind: Secret
metadata:
  name: monitoring-secrets
  namespace: cortex-monitoring
  labels:
    app.kubernetes.io/name: monitoring
    app.kubernetes.io/component: secrets
    app.kubernetes.io/part-of: cortex-memory
  annotations:
    description: 'Monitoring service secrets - replace with real values'
type: Opaque
data:
  # Grafana admin credentials
  GRAFANA_ADMIN_USER: YWRtaW4= # admin
  GRAFANA_ADMIN_PASSWORD: Y2hhbmdlLW1lLWluLXByb2R1Y3Rpb24= # change-me-in-production
  GRAFANA_SECRET_KEY: Y2hhbmdlLW1lLWluLXByb2R1Y3Rpb24tc2VjcmV0LWtleQ== # change-me-in-production-secret-key

---
# Alertmanager Configuration Secret
apiVersion: v1
kind: Secret
metadata:
  name: alertmanager-config
  namespace: cortex-monitoring
  labels:
    app.kubernetes.io/name: alertmanager
    app.kubernetes.io/component: config
    app.kubernetes.io/part-of: cortex-memory
  annotations:
    description: 'Alertmanager configuration with notification settings'
type: Opaque
stringData:
  alertmanager.yml: |
    global:
      smtp_smarthost: 'smtp.example.com:587'
      smtp_from: 'alerts@cortex-mcp.example.com'
      smtp_auth_username: 'alerts@cortex-mcp.example.com'
      smtp_auth_password: 'change-me-in-production'

    route:
      group_by: ['alertname', 'cluster', 'service']
      group_wait: 10s
      group_interval: 10s
      repeat_interval: 12h
      receiver: 'default-receiver'
      routes:
        - match:
            severity: critical
          receiver: 'critical-alerts'
        - match:
            severity: warning
          receiver: 'warning-alerts'

    receivers:
      - name: 'default-receiver'
        email_configs:
          - to: 'team@cortex-mcp.example.com'
            subject: '[Cortex MCP] {{ .GroupLabels.alertname }}'
            body: |
              {{ range .Alerts }}
              Alert: {{ .Annotations.summary }}
              Description: {{ .Annotations.description }}
              Labels: {{ range .Labels.SortedPairs }}{{ .Name }}={{ .Value }} {{ end }}
              {{ end }}

      - name: 'critical-alerts'
        email_configs:
          - to: 'critical-alerts@cortex-mcp.example.com'
            subject: '[CRITICAL] Cortex MCP Alert: {{ .GroupLabels.alertname }}'
            body: |
              CRITICAL ALERT TRIGGERED

              {{ range .Alerts }}
              Alert: {{ .Annotations.summary }}
              Description: {{ .Annotations.description }}
              Severity: {{ .Labels.severity }}
              Instance: {{ .Labels.instance }}
              Time: {{ .StartsAt }}

              Labels: {{ range .Labels.SortedPairs }}{{ .Name }}={{ .Value }} {{ end }}
              {{ end }}

        slack_configs:
          - api_url: 'https://hooks.slack.com/services/YOUR/SLACK/WEBHOOK'
            channel: '#cortex-alerts'
            title: 'CRITICAL: Cortex MCP Alert'
            text: '{{ range .Alerts }}{{ .Annotations.summary }}{{ end }}'

      - name: 'warning-alerts'
        email_configs:
          - to: 'warnings@cortex-mcp.example.com'
            subject: '[WARNING] Cortex MCP Alert: {{ .GroupLabels.alertname }}'
            body: |
              Warning alert triggered

              {{ range .Alerts }}
              Alert: {{ .Annotations.summary }}
              Description: {{ .Annotations.description }}
              Instance: {{ .Labels.instance }}
              {{ end }}

    inhibit_rules:
      - source_match:
          severity: 'critical'
        target_match:
          severity: 'warning'
        equal: ['alertname', 'cluster', 'service']

---
# TLS Certificate Secret (for HTTPS)
apiVersion: v1
kind: Secret
metadata:
  name: cortex-mcp-tls
  namespace: cortex-mcp
  labels:
    app.kubernetes.io/name: cortex-mcp
    app.kubernetes.io/component: tls
    app.kubernetes.io/part-of: cortex-memory
  annotations:
    description: 'TLS certificate for Cortex MCP - replace with actual certificate'
type: kubernetes.io/tls
data:
  # Replace with your actual TLS certificate and key (base64 encoded)
  tls.crt: LS0tLS1CRUdJTiBDRVJUSUZJQ0FURS0tLS0tCg== # your-tls-certificate
  tls.key: LS0tLS1CRUdJTiBQUklWQVRFIEtFWS0tLS0tCg== # your-tls-private-key

---
# Docker Registry Secret (for pulling private images)
apiVersion: v1
kind: Secret
metadata:
  name: registry-credentials
  namespace: cortex-mcp
  labels:
    app.kubernetes.io/name: cortex-mcp
    app.kubernetes.io/component: registry
    app.kubernetes.io/part-of: cortex-memory
  annotations:
    description: 'Docker registry credentials for pulling private images'
type: kubernetes.io/dockerconfigjson
data:
  # Replace with your actual docker config JSON (base64 encoded)
  # Generate with: kubectl create secret docker-registry registry-credentials --docker-server=<your-registry-server> --docker-username=<your-username> --docker-password=<your-password> --docker-email=<your-email> --dry-run=client -o yaml
  .dockerconfigjson: eyJhdXRocyI6eyJyZWdpc3RyeS5leGFtcGxlLmNvbSI6eyJ1c2VybmFtZSI6InVzZXIiLCJwYXNzd29yZCI6InBhc3MiLCJhdXRoIjoiZFhObGNqcHdZWE56In19fQ==
